<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ¨ JSONæ ¼å¼åŒ–å·¥å…· | ESA Pageså‚èµ›ä½œå“</title>
    <style>
        /* å…¨å±€CSSå˜é‡ - æ”¯æŒä¸»é¢˜åˆ‡æ¢ */
        :root {
            --primary-color: #409eff;
            --primary-light: #66b1ff;
            --primary-dark: #337ecc;
            --danger-color: #f56c6c;
            --danger-light: #f78989;
            --success-color: #67c23a;
            --success-light: #85ce61;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --text-main: #333333;
            --text-secondary: #666666;
            --text-placeholder: #999999;
            --border-color: #dcdfe6;
            --border-hover: #409eff;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-hover: 0 4px 20px rgba(64, 158, 255, 0.15);
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --primary-color: #54a0ff;
            --primary-light: #7baef7;
            --primary-dark: #2f7ed8;
            --danger-color: #f08080;
            --danger-light: #f49898;
            --success-color: #70c050;
            --success-light: #88d070;
            --bg-color: #1a1a2e;
            --card-bg: #252540;
            --text-main: #e0e0e0;
            --text-secondary: #a0a0c0;
            --text-placeholder: #707090;
            --border-color: #353555;
            --border-hover: #54a0ff;
            --shadow: 0 2px 10px rgba(0,0,0,0.3);
            --shadow-hover: 0 4px 20px rgba(84, 160, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft Yahei", "Consolas", monospace;
        }

        body {
            background-color: var(--bg-color);
            background-image: linear-gradient(120deg, var(--bg-color), var(--bg-color) 80%, rgba(64, 158, 255, 0.05));
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            color: var(--text-main);
            transition: var(--transition);
            min-height: 100vh;
        }

        /* é¡¶éƒ¨æ ‡é¢˜æ  */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .title {
            font-size: 28px;
            font-weight: 600;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 1px;
            position: relative;
        }

        .title::after {
            content: "";
            position: absolute;
            bottom: -6px;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), transparent);
            border-radius: 3px;
        }

        .theme-switch {
            padding: 8px 16px;
            border-radius: 20px;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            color: var(--text-main);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .theme-switch:hover {
            border-color: var(--border-hover);
            box-shadow: var(--shadow-hover);
        }

        /* ä¸»å®¹å™¨ */
        .container {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        @media (min-width: 768px) {
            .container {
                flex-direction: row;
            }
            .input-area, .output-area {
                flex: 1;
            }
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 18px;
            color: var(--primary-color);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .char-count {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* æ–‡æœ¬æ¡†æ ·å¼ */
        textarea {
            width: 100%;
            height: 350px;
            padding: 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            outline: none;
            background-color: var(--card-bg);
            color: var(--text-main);
            transition: var(--transition);
            font-family: "Consolas", monospace;
        }

        textarea:focus {
            border-color: var(--border-hover);
            box-shadow: 0 0 0 2px rgba(64, 158, 255, 0.1);
        }

        textarea::placeholder {
            color: var(--text-placeholder);
        }

        /* è¯­æ³•é«˜äº®å®¹å™¨ */
        #jsonOutput {
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-y: auto;
        }

        /* JSONè¯­æ³•é«˜äº®æ ·å¼ */
        .json-key { color: #e57373; }
        .json-string { color: #66bb6a; }
        .json-number { color: #81c784; }
        .json-boolean { color: #4fc3f7; }
        .json-null { color: #9575cd; }

        /* æŒ‰é’®ç»„ */
        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(64, 158, 255, 0.2);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: var(--success-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(103, 194, 58, 0.2);
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: var(--danger-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 108, 108, 0.2);
        }

        .btn-default {
            background-color: transparent;
            color: var(--text-main);
            border: 1px solid var(--border-color);
        }

        .btn-default:hover {
            border-color: var(--border-hover);
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        /* æç¤ºæ–‡æœ¬ */
        .tip {
            margin-top: 12px;
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .error {
            color: var(--danger-color);
            font-weight: 500;
            animation: shake 0.3s ease;
        }

        .success {
            color: var(--success-color);
            font-weight: 500;
        }

        /* æ‹–æ‹½æç¤º */
        .drag-over {
            border: 2px dashed var(--primary-color);
            background-color: rgba(64, 158, 255, 0.05);
        }

        /* å¤åˆ¶æˆåŠŸåŠ¨ç”» */
        @keyframes copySuccess {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 0; }
        }

        .copy-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            font-size: 16px;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            animation: copySuccess 1s ease forwards;
        }

        /* é”™è¯¯æŠ–åŠ¨åŠ¨ç”» */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* é€‚é…ç§»åŠ¨ç«¯ */
        @media (max-width: 767px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            textarea {
                height: 250px;
            }
            .btn-group {
                justify-content: center;
            }
            button {
                flex: 1;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨æ ‡é¢˜+ä¸»é¢˜åˆ‡æ¢ -->
    <div class="header">
        <h1 class="title">âœ¨ JSONæ ¼å¼åŒ–å·¥å…·</h1>
        <button class="theme-switch" id="themeSwitch">
            <span id="themeIcon">ğŸŒ</span>
            <span id="themeText">åˆ‡æ¢æš—é»‘æ¨¡å¼</span>
        </button>
    </div>

    <!-- å¤åˆ¶æˆåŠŸæç¤º -->
    <div class="copy-toast" id="copyToast">âœ… å¤åˆ¶æˆåŠŸï¼</div>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="input-area card">
            <div class="card-header">
                <h3 class="card-title">ğŸ“¥ è¾“å…¥/ç²˜è´´JSONæ–‡æœ¬</h3>
                <span class="char-count" id="inputCharCount">å­—ç¬¦æ•°ï¼š0</span>
            </div>
            <textarea 
                id="jsonInput" 
                placeholder="ç¤ºä¾‹ï¼š{&quot;name&quot;:&quot;ESA Pages&quot;,&quot;type&quot;:&quot;å‰ç«¯å·¥å…·&quot;,&quot;version&quot;:1.0,&quot;enabled&quot;:true}"
                oninput="updateCharCount()"
            ></textarea>
            <div class="btn-group">
                <button class="btn-primary" onclick="formatJson()">ğŸ“ æ ¼å¼åŒ–JSON</button>
                <button class="btn-success" onclick="compressJson()">ğŸ—œï¸ å‹ç¼©JSON</button>
                <button class="btn-default" onclick="clearInput()">ğŸ§¹ æ¸…ç©ºè¾“å…¥</button>
                <button class="btn-default" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰</button>
            </div>
            <div id="errorTip" class="tip"></div>
            <div class="tip">ğŸ’¡ æ”¯æŒæ‹–æ‹½JSONæ–‡ä»¶åˆ°è¾“å…¥æ¡†ç›´æ¥è§£æ</div>
        </div>

        <!-- è¾“å‡ºåŒºåŸŸ -->
        <div class="output-area card">
            <div class="card-header">
                <h3 class="card-title">ğŸ“¤ å¤„ç†ç»“æœ</h3>
                <span class="char-count" id="outputCharCount">å­—ç¬¦æ•°ï¼š0</span>
            </div>
            <div id="jsonOutput" placeholder="æ ¼å¼åŒ–/å‹ç¼©åçš„JSONä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ..."></div>
            <div class="btn-group">
                <button class="btn-primary" onclick="copyOutput()">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
                <button class="btn-success" onclick="downloadJson()">ğŸ’¾ ä¸‹è½½æ–‡ä»¶</button>
                <button class="btn-default" onclick="clearOutput()">ğŸ§¹ æ¸…ç©ºç»“æœ</button>
            </div>
            <div id="copyTip" class="tip"></div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentTheme = localStorage.getItem('jsonToolTheme') || 'light';
        const jsonInput = document.getElementById('jsonInput');
        const jsonOutput = document.getElementById('jsonOutput');
        const errorTip = document.getElementById('errorTip');
        const copyTip = document.getElementById('copyTip');
        const themeSwitch = document.getElementById('themeSwitch');
        const themeIcon = document.getElementById('themeIcon');
        const themeText = document.getElementById('themeText');
        const copyToast = document.getElementById('copyToast');
        const inputCharCount = document.getElementById('inputCharCount');
        const outputCharCount = document.getElementById('outputCharCount');

        // åˆå§‹åŒ–ä¸»é¢˜
        document.documentElement.setAttribute('data-theme', currentTheme);
        updateThemeUI();

        // ä¸»é¢˜åˆ‡æ¢
        themeSwitch.addEventListener('click', () => {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            localStorage.setItem('jsonToolTheme', currentTheme);
            updateThemeUI();
            // é‡æ–°é«˜äº®è¾“å‡ºå†…å®¹ï¼ˆä¸»é¢˜åˆ‡æ¢åé¢œè‰²åŒæ­¥ï¼‰
            if (jsonOutput.innerHTML) {
                const text = jsonOutput.textContent || jsonOutput.innerText;
                if (text) {
                    try {
                        JSON.parse(text);
                        jsonOutput.innerHTML = syntaxHighlight(text);
                    } catch (e) {
                        jsonOutput.textContent = text;
                    }
                }
            }
        });

        // æ›´æ–°ä¸»é¢˜UI
        function updateThemeUI() {
            if (currentTheme === 'dark') {
                themeIcon.textContent = 'ğŸŒ™';
                themeText.textContent = 'åˆ‡æ¢äº®è‰²æ¨¡å¼';
            } else {
                themeIcon.textContent = 'ğŸŒ';
                themeText.textContent = 'åˆ‡æ¢æš—é»‘æ¨¡å¼';
            }
        }

        // æ›´æ–°å­—ç¬¦è®¡æ•°
        function updateCharCount() {
            // è¾“å…¥åŒºåŸŸè®¡æ•°
            const inputLen = jsonInput.value.trim().length;
            inputCharCount.textContent = `å­—ç¬¦æ•°ï¼š${inputLen}`;
            
            // è¾“å‡ºåŒºåŸŸè®¡æ•°
            const outputText = jsonOutput.textContent || jsonOutput.innerText;
            const outputLen = outputText.trim().length;
            outputCharCount.textContent = `å­—ç¬¦æ•°ï¼š${outputLen}`;
        }

        // JSONè¯­æ³•é«˜äº®
        function syntaxHighlight(json) {
            if (typeof json !== 'string') {
                json = JSON.stringify(json, undefined, 2);
            }
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'json-key';
                    } else {
                        cls = 'json-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'json-boolean';
                } else if (/null/.test(match)) {
                    cls = 'json-null';
                }
                return `<span class="${cls}">${match}</span>`;
            });
        }

        // æ ¼å¼åŒ–JSON
        function formatJson() {
            const input = jsonInput.value.trim();
            errorTip.textContent = '';
            errorTip.classList.remove('error');

            if (!input) {
                errorTip.textContent = 'æç¤ºï¼šè¯·è¾“å…¥JSONæ–‡æœ¬ï¼';
                jsonOutput.innerHTML = '';
                updateCharCount();
                return;
            }

            try {
                const parsedJson = JSON.parse(input);
                const formattedJson = JSON.stringify(parsedJson, null, 2);
                jsonOutput.innerHTML = syntaxHighlight(formattedJson);
                errorTip.textContent = 'âœ… JSONæ ¼å¼æ­£ç¡®ï¼Œå·²å®Œæˆæ ¼å¼åŒ–ï¼';
                errorTip.classList.add('success');
            } catch (e) {
                // è§£æé”™è¯¯ä½ç½®
                const errorMsg = e.message;
                let errorPos = 'æœªçŸ¥ä½ç½®';
                const match = /position (\d+)/.exec(errorMsg);
                if (match) {
                    errorPos = `ç¬¬ ${match[1]} ä¸ªå­—ç¬¦`;
                }
                errorTip.textContent = `âŒ JSONæ ¼å¼é”™è¯¯ï¼ˆ${errorPos}ï¼‰ï¼š${errorMsg}`;
                errorTip.classList.add('error');
                jsonOutput.innerHTML = '';
            }
            updateCharCount();
        }

        // å‹ç¼©JSON
        function compressJson() {
            const input = jsonInput.value.trim();
            errorTip.textContent = '';
            errorTip.classList.remove('error');

            if (!input) {
                errorTip.textContent = 'æç¤ºï¼šè¯·è¾“å…¥JSONæ–‡æœ¬ï¼';
                jsonOutput.innerHTML = '';
                updateCharCount();
                return;
            }

            try {
                const parsedJson = JSON.parse(input);
                const compressedJson = JSON.stringify(parsedJson);
                jsonOutput.innerHTML = syntaxHighlight(compressedJson);
                errorTip.textContent = 'âœ… JSONæ ¼å¼æ­£ç¡®ï¼Œå·²å®Œæˆå‹ç¼©ï¼';
                errorTip.classList.add('success');
            } catch (e) {
                const errorMsg = e.message;
                let errorPos = 'æœªçŸ¥ä½ç½®';
                const match = /position (\d+)/.exec(errorMsg);
                if (match) {
                    errorPos = `ç¬¬ ${match[1]} ä¸ªå­—ç¬¦`;
                }
                errorTip.textContent = `âŒ JSONæ ¼å¼é”™è¯¯ï¼ˆ${errorPos}ï¼‰ï¼š${errorMsg}`;
                errorTip.classList.add('error');
                jsonOutput.innerHTML = '';
            }
            updateCharCount();
        }

        // å¤åˆ¶ç»“æœ
        function copyOutput() {
            const outputText = jsonOutput.textContent || jsonOutput.innerText;
            
            if (!outputText) {
                copyTip.textContent = 'âŒ æš‚æ— å†…å®¹å¯å¤åˆ¶ï¼';
                copyTip.classList.add('error');
                setTimeout(() => copyTip.textContent = '', 2000);
                return;
            }

            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            navigator.clipboard.writeText(outputText).then(() => {
                // æ˜¾ç¤ºåŠ¨ç”»æç¤º
                copyToast.style.animation = 'none';
                copyToast.offsetHeight; // è§¦å‘é‡ç»˜
                copyToast.style.animation = 'copySuccess 1s ease forwards';
                copyTip.textContent = '';
            }).catch(() => {
                // å…¼å®¹ä½ç‰ˆæœ¬æµè§ˆå™¨
                const textArea = document.createElement('textarea');
                textArea.value = outputText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                copyToast.style.animation = 'none';
                copyToast.offsetHeight;
                copyToast.style.animation = 'copySuccess 1s ease forwards';
                copyTip.textContent = '';
            });
        }

        // ä¸‹è½½JSONæ–‡ä»¶
        function downloadJson() {
            const outputText = jsonOutput.textContent || jsonOutput.innerText;
            
            if (!outputText) {
                copyTip.textContent = 'âŒ æš‚æ— å†…å®¹å¯ä¸‹è½½ï¼';
                copyTip.classList.add('error');
                setTimeout(() => copyTip.textContent = '', 2000);
                return;
            }

            // åˆ›å»ºBlobå¯¹è±¡
            const blob = new Blob([outputText], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const a = document.createElement('a');
            a.href = url;
            a.download = `json_tool_${new Date().getTime()}.json`;
            a.click();
            
            // é‡Šæ”¾URL
            URL.revokeObjectURL(url);
            copyTip.textContent = 'âœ… æ–‡ä»¶ä¸‹è½½æˆåŠŸï¼';
            copyTip.classList.add('success');
            setTimeout(() => copyTip.textContent = '', 3000);
        }

        // æ¸…ç©ºè¾“å…¥
        function clearInput() {
            jsonInput.value = '';
            errorTip.textContent = '';
            errorTip.classList.remove('error', 'success');
            updateCharCount();
        }

        // æ¸…ç©ºè¾“å‡º
        function clearOutput() {
            jsonOutput.innerHTML = '';
            copyTip.textContent = '';
            copyTip.classList.remove('error', 'success');
            updateCharCount();
        }

        // æ¸…ç©ºæ‰€æœ‰
        function clearAll() {
            clearInput();
            clearOutput();
        }

        // æ‹–æ‹½æ–‡ä»¶è§£æ
        jsonInput.addEventListener('dragover', (e) => {
            e.preventDefault();
            jsonInput.classList.add('drag-over');
        });

        jsonInput.addEventListener('dragleave', () => {
            jsonInput.classList.remove('drag-over');
        });

        jsonInput.addEventListener('drop', (e) => {
            e.preventDefault();
            jsonInput.classList.remove('drag-over');
            
            const file = e.dataTransfer.files[0];
            if (file && file.type === 'application/json') {
                const reader = new FileReader();
                reader.onload = (event) => {
                    jsonInput.value = event.target.result;
                    updateCharCount();
                    formatJson(); // è‡ªåŠ¨æ ¼å¼åŒ–
                };
                reader.readAsText(file);
            } else {
                errorTip.textContent = 'âŒ è¯·æ‹–æ‹½JSONæ ¼å¼çš„æ–‡ä»¶ï¼';
                errorTip.classList.add('error');
                setTimeout(() => errorTip.textContent = '', 3000);
            }
        });

        // é¡µé¢åŠ è½½åˆå§‹åŒ–
        window.onload = function() {
            const exampleJson = {
                "name": "ESA Pages JSONå·¥å…·",
                "author": "å‚èµ›ä½œå“",
                "features": ["æ ¼å¼åŒ–", "å‹ç¼©", "è¯­æ³•é«˜äº®", "ä¸»é¢˜åˆ‡æ¢", "æ‹–æ‹½è§£æ", "ä¸‹è½½æ–‡ä»¶"],
                "version": "2.0.0",
                "enabled": true,
                "updateTime": new Date().toLocaleString()
            };
            jsonInput.value = JSON.stringify(exampleJson);
            updateCharCount();
            formatJson();
        };
    </script>
</body>
</html>